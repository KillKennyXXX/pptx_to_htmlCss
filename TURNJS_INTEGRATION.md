# TurnJS Integration Guide

## Обзор

В версии 17.0 конвертер интегрирован с профессиональным шаблоном TurnJS из папки `template_new`, который обеспечивает реалистичный эффект перелистывания страниц журнала.

## Что изменилось

### ✅ Новая функциональность

1. **TurnJS шаблон по умолчанию** - Теперь используется `template_new` вместо старого `template`
2. **Автоматическая генерация изображений** - Слайды автоматически конвертируются в JPG изображения
3. **Профессиональный UI** - Миниатюры, зум, эффекты загиба страниц
4. **Адаптивная генерация** - Автоматическое создание обычных и увеличенных версий изображений

### ❌ Удаленная функциональность

- Старый шаблон `template` больше не используется
- Функция `apply_flipbook_template` сохранена для совместимости, но не используется

## Архитектура

```
pptx_to_html.py
├── convert()                    # Основная конвертация PPTX → HTML/CSS
├── generate_slide_images()      # HTML → JPG изображения (Playwright)
├── apply_turnjs_template()      # Копирование template_new + настройка
└── generate_thumbnails_html()   # Генерация HTML для миниатюр
```

## Использование

### Базовое использование

```bash
python pptx_to_html.py presentation.pptx output_folder
```

По умолчанию используется TurnJS шаблон.

### Использование стандартного шаблона

Если нужен простой слайдер без TurnJS:

```bash
python pptx_to_html.py presentation.pptx output_folder --template default
```

## Технические детали

### Процесс конвертации

1. **PPTX → HTML/CSS**
   - Извлечение всех слайдов
   - Конвертация фигур, текста, изображений
   - Генерация `index.html` и `style.css`

2. **HTML → Изображения** (для TurnJS)
   - Запуск Playwright/Chromium
   - Рендеринг каждого слайда в браузере
   - Создание 3 версий каждого слайда:
     - `{N}.jpg` - основное изображение (качество 90%)
     - `{N}-thumb.jpg` - миниатюра 76x100 (качество 70%)
     - `{N}-large.jpg` - для зума (качество 95%)
   - Создание пустых `{N}-regions.json` (для интерактивных зон)

3. **Интеграция с TurnJS**
   - Копирование CSS, JS, pics из `template_new`
   - Генерация HTML миниатюр
   - Модификация `index.html` с правильным количеством страниц
   - Замена секции миниатюр

### Структура выходной папки

```
output_folder/
├── index.html          # TurnJS интерфейс
├── style.css           # Стили слайдов
├── metadata.json       # Метаданные презентации
├── css/                # TurnJS стили
│   ├── magazine.css
│   ├── jquery.ui.css
│   └── jquery.ui.html4.css
├── js/                 # TurnJS библиотеки
│   ├── jquery.min.1.7.js
│   ├── turn.min.js
│   ├── zoom.min.js
│   ├── magazine.js
│   └── ...
├── pics/               # Иконки UI
│   ├── arrows.png
│   ├── zoom.png
│   └── ...
├── pages/              # Изображения слайдов
│   ├── 1.jpg
│   ├── 1-thumb.jpg
│   ├── 1-large.jpg
│   ├── 1-regions.json
│   ├── 2.jpg
│   └── ...
└── images/             # Оригинальные изображения из PPTX
    └── ...
```

## Зависимости

### Обязательные

```txt
python-pptx>=0.6.21     # Парсинг PPTX
Pillow>=10.0.0          # Обработка изображений
playwright>=1.40.0      # Рендеринг HTML → изображения
```

### Установка

```bash
pip install -r requirements.txt
playwright install chromium
```

## Функции

### `generate_slide_images(output_dir)`

Генерирует изображения слайдов из HTML.

**Процесс:**
1. Проверка наличия Playwright
2. Запуск headless Chromium
3. Загрузка `index.html`
4. Поиск всех элементов `.slide`
5. Для каждого слайда:
   - Скриншот → `{N}.jpg`
   - Создание миниатюры → `{N}-thumb.jpg`
   - Скриншот высокого качества → `{N}-large.jpg`
   - Создание пустого `{N}-regions.json`

**Возвращает:** `True` при успехе, `False` при ошибке

### `apply_turnjs_template(output_dir, num_slides)`

Применяет TurnJS шаблон к сконвертированной презентации.

**Процесс:**
1. Копирование `css/`, `js/`, `pics/` из `template_new`
2. Чтение шаблона `template_new/index.html`
3. Генерация HTML миниатюр через `generate_thumbnails_html()`
4. Замена секции миниатюр в шаблоне
5. Обновление параметра `pages: N`
6. Сохранение модифицированного `index.html`

**Параметры:**
- `output_dir` - папка с результатами конвертации
- `num_slides` - количество слайдов

**Возвращает:** `True` при успехе, `False` при ошибке

### `generate_thumbnails_html(num_slides)`

Генерирует HTML разметку для миниатюр страниц.

**Логика:**
- Первая страница: одиночная (`<li class="i">`)
- Страницы 2-N: развороты по 2 страницы (`<li class="d">`)
- Последняя страница (если четная): одиночная

**Возвращает:** HTML строка

## Устранение неполадок

### Ошибка: "Playwright не установлен"

```bash
pip install playwright
playwright install chromium
```

### Ошибка: "Слайды не найдены в HTML"

Проблема в CSS или структуре HTML. Проверьте:
1. Наличие элементов с классом `.slide`
2. Правильность генерации `index.html`

### Миниатюры полноразмерные

Установите Pillow:
```bash
pip install pillow
```

### Медленная генерация изображений

Это нормально - рендеринг в Chromium требует времени.
Для 10 слайдов ≈ 10-20 секунд.

## Отличия от старого шаблона

| Функция | template (старый) | template_new (TurnJS) |
|---------|-------------------|----------------------|
| Эффект перелистывания | Простая анимация | Реалистичный 3D эффект |
| Миниатюры | Нет | Да, внизу страницы |
| Зум | Нет | Да, клик по странице |
| Формат данных | HTML элементы | JPG изображения |
| Производительность | Высокая | Средняя (рендеринг) |
| Размер выходных файлов | Малый | Средний (изображения) |

## Планы развития

- [ ] Поддержка интерактивных областей (regions)
- [ ] Извлечение QR-кодов и ссылок в regions
- [ ] Оптимизация размера изображений
- [ ] Кэширование для ускорения повторной генерации
- [ ] Поддержка видео и анимаций

## Примечания

1. **Качество изображений**: Регулируется параметрами `quality` в `screenshot()`
2. **Размеры слайдов**: Зависят от размера в CSS (из `generate_html()`)
3. **Совместимость браузеров**: TurnJS поддерживает IE9+, все современные браузеры
4. **Мобильные устройства**: TurnJS имеет поддержку тач-жестов

## Версионирование

- **v17.0** - Интеграция TurnJS, переход на template_new
- **v16.6** - Последняя версия с template (FlipBook)
- **v16.5** - Первая версия FlipBook шаблона
